# Amazon EMR ç‰ˆæœ¬å‡çº§åŠ©æ‰‹

åŸºäº AI å’Œ OpenSearch MCP Server çš„æ™ºèƒ½ EMR å‡çº§åŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·è§£å†³ Amazon EMR ç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„å„ç§é—®é¢˜ã€‚

## ğŸŒŸ åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **æ™ºèƒ½å¯¹è¯**: åŸºäº AI Agent çš„è‡ªç„¶è¯­è¨€äº¤äº’
- ğŸ“š **çŸ¥è¯†åº“é›†æˆ**: ç›´æ¥è°ƒç”¨ä½ å·²å®ç°çš„ MCP Server
- ğŸ§  **ä¸Šä¸‹æ–‡è®°å¿†**: ä½¿ç”¨ Mem0 å­˜å‚¨å’Œæ£€ç´¢å¯¹è¯å†å²ï¼Œæä¾›ä¸ªæ€§åŒ–ä½“éªŒ
- ğŸ”„ **ç‰ˆæœ¬å‡çº§æŒ‡å¯¼**: æä¾›è¯¦ç»†çš„ EMR ç‰ˆæœ¬å‡çº§å»ºè®®
- ğŸ› ï¸ **ç»„ä»¶å…¼å®¹æ€§**: åˆ†æ Hiveã€Sparkã€Flinkã€HBase ç­‰ç»„ä»¶çš„å…¼å®¹æ€§
- ğŸ’» **Web ç•Œé¢**: ç”¨æˆ·å‹å¥½çš„èŠå¤©ç•Œé¢
- ğŸ” **æ™ºèƒ½æ£€ç´¢**: åŸºäºè¯­ä¹‰æœç´¢å’Œå…³é”®è¯æœç´¢çš„æ··åˆæ£€ç´¢

## ğŸ—ï¸ æ¶æ„ç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Frontend  â”‚â”€â”€â”€â–¶â”‚  Flask App      â”‚â”€â”€â”€â–¶â”‚ EMR Agent       â”‚
â”‚   (Chat UI)     â”‚    â”‚  (Web Server)   â”‚    â”‚ (Claude + MCP)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                          â”‚
                            â”‚                          â–¼
                            â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚                 â”‚   MCP Server    â”‚â”€â”€â”€â”
                            â”‚                 â”‚ (search_context)â”‚   â”‚
                            â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â”‚                                       â–¼
                            â–¼                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   OpenSearch    â”‚
                     â”‚   Mem0 Memory   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (Knowledge DB) â”‚
                     â”‚   (User Context)â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

1. **Web Frontend**: ç”¨æˆ·å‹å¥½çš„èŠå¤©ç•Œé¢ï¼Œæ”¯æŒæ˜¾ç¤ºå·¥å…·ä½¿ç”¨æƒ…å†µå’ŒçŸ¥è¯†åº“å†…å®¹
2. **Flask App**: Web æœåŠ¡å™¨ï¼Œå¤„ç† HTTP è¯·æ±‚å’Œä¼šè¯ç®¡ç†
3. **EMR Agent**: åŸºäº Anthropic Claude çš„æ™ºèƒ½ AI ä»£ç†ï¼Œé€šè¿‡ MCP åè®®è°ƒç”¨å·¥å…·
4. **MCP Server**: ä½ å·²å®ç°çš„ OpenSearch è¿æ¥æœåŠ¡ï¼Œæä¾› `search_context` å·¥å…·
5. **OpenSearch**: å­˜å‚¨ EMR å‡çº§çŸ¥è¯†åº“çš„æœç´¢å¼•æ“ï¼Œæ”¯æŒæ··åˆæœç´¢
6. **Mem0 Memory**: åŸºäº OpenSearch çš„ä¸Šä¸‹æ–‡è®°å¿†ç³»ç»Ÿï¼Œå­˜å‚¨ç”¨æˆ·å¯¹è¯å†å²å¹¶æä¾›ä¸ªæ€§åŒ–ä½“éªŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10+
- Strands Agents SDK API Key
- AWS è´¦æˆ·ï¼ˆç”¨äº OpenSearch å’Œ Secrets Managerï¼‰
- OpenSearch é›†ç¾¤ï¼ˆå·²é…ç½® EMR çŸ¥è¯†åº“ï¼‰

### âš ï¸ é‡è¦æç¤º

**è¯·å…ˆå‚è€ƒ [Strands Agents å®˜æ–¹æ–‡æ¡£](https://strandsagents.com/latest/user-guide/quickstart/) è°ƒæ•´ä»£ç ä¸­çš„ API è°ƒç”¨ï¼**

å½“å‰ä»£ç ä¸­åŒ…å«äº†éœ€è¦æ ¹æ®å®˜æ–¹æ–‡æ¡£è°ƒæ•´çš„éƒ¨åˆ†ï¼Œå·²åœ¨ä»£ç æ³¨é‡Šä¸­æ ‡æ˜ã€‚

### 1. å…‹éš†å’Œå®‰è£…

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd emr_upgrade_assistant

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å‚æ•°ï¼š
```

**å¿…éœ€é…ç½®é¡¹ï¼š**

```env
# Anthropic API é…ç½®
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# AWS é…ç½® (MCP Server éœ€è¦)
AWS_REGION=us-east-1
OPENSEARCH_HOST=your-opensearch-domain.us-east-1.es.amazonaws.com
OPENSEARCH_PORT=443
OPENSEARCH_SECRET_NAME=opensearch_credentials
OPENSEARCH_INDEX=opensearch_kl_index
OPENSEARCH_EMBEDDING_MODEL_ID=your_embedding_model_id

# Mem0 è®°å¿†ç³»ç»Ÿé…ç½®
MEM0_ENABLED=true
MEM0_USER_ID=emr_assistant_user
MEM0_OPENSEARCH_HOST=your-opensearch-domain.us-east-1.es.amazonaws.com
MEM0_OPENSEARCH_PORT=443
MEM0_OPENSEARCH_USERNAME=admin
MEM0_OPENSEARCH_PASSWORD=your_password
MEM0_OPENSEARCH_USE_SSL=true
MEM0_OPENSEARCH_VERIFY_CERTS=true
MEM0_OPENSEARCH_INDEX=emr_assistant_memories
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./start.sh

# æˆ–ç›´æ¥è¿è¡Œ
python app.py
```

### 4. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:5001`

## ğŸ’¬ ä½¿ç”¨è¯´æ˜

### åŸºæœ¬ä½¿ç”¨

1. åœ¨èŠå¤©ç•Œé¢è¾“å…¥æ‚¨çš„ EMR å‡çº§ç›¸å…³é—®é¢˜
2. AI åŠ©æ‰‹ä¼šè‡ªåŠ¨æœç´¢çŸ¥è¯†åº“å¹¶ç”Ÿæˆä¸“ä¸šå›ç­”
3. å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„çŸ¥è¯†åº“å†…å®¹ä½œä¸ºå‚è€ƒ

### ç¤ºä¾‹æŸ¥è¯¢

**ç‰ˆæœ¬å‡çº§ç›¸å…³ï¼š**
- "ä» EMR 5.36 å‡çº§åˆ° 6.10 éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"
- "EMR 6.x ç›¸æ¯” 5.x æœ‰å“ªäº›é‡å¤§å˜åŒ–ï¼Ÿ"

**ç»„ä»¶å…¼å®¹æ€§ï¼š**
- "EMR 6.10.0 å‡çº§åˆ° 6.11.0 åï¼ŒHive æœ‰å“ªäº›æ–°ç‰¹æ€§ï¼Ÿ"
- "Spark 3.x åœ¨ EMR 6.x ä¸­çš„é…ç½®å˜æ›´"
- "HBase åœ¨æ–°ç‰ˆæœ¬ä¸­çš„å…¼å®¹æ€§é—®é¢˜"

**æ•…éšœæ’é™¤ï¼š**
- "EMR å‡çº§å Spark ä½œä¸šå¤±è´¥å¦‚ä½•è§£å†³ï¼Ÿ"
- "Hive å…ƒæ•°æ®è¿ç§»çš„æœ€ä½³å®è·µ"

## ğŸ”§ é…ç½®è¯´æ˜

### AWS æƒé™è¦æ±‚

ç¡®ä¿æ‚¨çš„ AWS å‡­è¯å…·æœ‰ä»¥ä¸‹æƒé™ï¼š

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "bedrock:InvokeModel",
                "es:ESHttpGet",
                "es:ESHttpPost",
                "secretsmanager:GetSecretValue"
            ],
            "Resource": "*"
        }
    ]
}
```

### OpenSearch é…ç½®

ç¡®ä¿æ‚¨çš„ OpenSearch é›†ç¾¤ï¼š
1. å·²å®‰è£…å¹¶é…ç½®äº†åµŒå…¥æ¨¡å‹
2. å·²åˆ›å»ºæ··åˆæœç´¢ç®¡é“
3. å·²å¯¼å…¥ EMR ç›¸å…³çŸ¥è¯†åº“æ•°æ®

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. OpenSearch è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œå‡­è¯
curl -X GET "https://your-domain.us-east-1.es.amazonaws.com/_cluster/health"
```

**2. Bedrock è°ƒç”¨å¤±è´¥**
```bash
# æ£€æŸ¥ AWS å‡­è¯å’Œæƒé™
aws bedrock list-foundation-models --region us-east-1
```

**3. ä¾èµ–å®‰è£…é—®é¢˜**
```bash
# å‡çº§ pip å¹¶é‡æ–°å®‰è£…
pip install --upgrade pip
pip install -r requirements.txt --force-reinstall
```

### æ—¥å¿—æŸ¥çœ‹

åº”ç”¨æ—¥å¿—ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ï¼ŒåŒ…æ‹¬ï¼š
- OpenSearch è¿æ¥çŠ¶æ€
- MCP å®¢æˆ·ç«¯åˆå§‹åŒ–
- æŸ¥è¯¢å¤„ç†è¿‡ç¨‹
- é”™è¯¯ä¿¡æ¯

## ğŸ§  Mem0 è®°å¿†ç³»ç»Ÿ

### åŠŸèƒ½ç‰¹ç‚¹

- **ç”¨æˆ·éš”ç¦»**: æ¯ä¸ªæµè§ˆå™¨ä¼šè¯æ‹¥æœ‰ç‹¬ç«‹çš„è®°å¿†ç©ºé—´ï¼Œé€šè¿‡éšæœºç”Ÿæˆçš„ç”¨æˆ·IDå®ç°
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: è‡ªåŠ¨æ£€ç´¢ä¸å½“å‰é—®é¢˜ç›¸å…³çš„å†å²å¯¹è¯ï¼Œæä¾›æ›´è¿è´¯çš„å›ç­”
- **é•¿æœŸè®°å¿†**: å°†é‡è¦ä¿¡æ¯å­˜å‚¨åœ¨ OpenSearch ä¸­ï¼Œæ”¯æŒè·¨ä¼šè¯çš„çŸ¥è¯†ç´¯ç§¯
- **å®æ—¶æ›´æ–°**: æ¯æ¬¡å¯¹è¯åè‡ªåŠ¨æ›´æ–°è®°å¿†ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- **è®°å¿†ç®¡ç†**: æä¾›è®°å¿†ç»Ÿè®¡ã€æœç´¢å’Œæ¸…é™¤åŠŸèƒ½

### è®°å¿† API

- **è·å–è®°å¿†ç»Ÿè®¡**:
  ```
  GET /memory/stats
  ```

- **æœç´¢ç›¸å…³è®°å¿†**:
  ```
  POST /memory/search
  Content-Type: application/json
  
  {
    "query": "EMR å‡çº§",
    "limit": 5
  }
  ```

- **è·å–æœ€è¿‘è®°å¿†**:
  ```
  GET /memory/recent?limit=10
  ```

- **æ¸…é™¤æ‰€æœ‰è®°å¿†**:
  ```
  POST /memory/clear
  ```

### è®°å¿†å·¥å…·

EMR Agent å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·æ¥è®¿é—®è®°å¿†ç³»ç»Ÿ:

- `search_conversation_history`: æœç´¢ç›¸å…³çš„å†å²å¯¹è¯
- `get_recent_conversations`: è·å–æœ€è¿‘çš„å¯¹è¯è®°å½•
- `get_memory_statistics`: è·å–è®°å¿†ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
- `clear_conversation_history`: æ¸…é™¤æ‰€æœ‰å†å²å¯¹è¯è®°å½•

## ğŸ”„ å¼€å‘å’Œæ‰©å±•

### é¡¹ç›®ç»“æ„

```
emr_upgrade_assistant/
â”œâ”€â”€ app.py              # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ mem0_integration.py # Mem0 è®°å¿†ç³»ç»Ÿé›†æˆ
â”œâ”€â”€ mem0_tools.py       # Mem0 å·¥å…·é›†
â”œâ”€â”€ requirements.txt    # Python ä¾èµ–
â”œâ”€â”€ .env.example        # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ start.sh            # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ templates/          # HTML æ¨¡æ¿
â”‚   â””â”€â”€ index.html
â””â”€â”€ static/             # é™æ€æ–‡ä»¶
    â””â”€â”€ style.css
```

### è‡ªå®šä¹‰æ‰©å±•

1. **æ·»åŠ æ–°çš„æœç´¢åŠŸèƒ½**: ä¿®æ”¹ `mcp_client.py` ä¸­çš„æœç´¢é€»è¾‘
2. **è‡ªå®šä¹‰ UI**: ç¼–è¾‘ `templates/index.html` å’Œ `static/style.css`
3. **é›†æˆå…¶ä»– LLM**: ä¿®æ”¹ `app.py` ä¸­çš„ `call_llm` æ–¹æ³•

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼